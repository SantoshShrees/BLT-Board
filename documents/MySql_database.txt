--my database 
USE bbs11;

-- 1) Drop old tables if they exist (safe reset)
SET FOREIGN_KEY_CHECKS = 0;
DROP TABLE IF EXISTS COMMENTS;
DROP TABLE IF EXISTS POSTS;
DROP TABLE IF EXISTS THREADS;
DROP TABLE IF EXISTS USERS;
SET FOREIGN_KEY_CHECKS = 1;

-- 2) Create USERS
CREATE TABLE USERS (
    user_id     INT AUTO_INCREMENT PRIMARY KEY,
    user_name   VARCHAR(50)  NOT NULL,
    user_pass   VARCHAR(255) NOT NULL,
    created_at  DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 3) Create THREADS
CREATE TABLE THREADS (
    thread_id    INT AUTO_INCREMENT PRIMARY KEY,
    thread_title VARCHAR(255) NOT NULL,
    user_id      INT NOT NULL,
    created_at   DATETIME DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT FK_THREADS_USERS
        FOREIGN KEY (user_id)
        REFERENCES USERS(user_id)
);

-- 4) Create POSTS
CREATE TABLE POSTS (
    post_id      INT AUTO_INCREMENT PRIMARY KEY,
    thread_id    INT NOT NULL,
    user_id      INT NOT NULL,
    post_number  INT NOT NULL,
    post_content VARCHAR(400) NOT NULL,
    post_date    DATETIME DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_posts_threads FOREIGN KEY (thread_id) REFERENCES THREADS(thread_id),
    CONSTRAINT fk_posts_users   FOREIGN KEY (user_id)   REFERENCES USERS(user_id)
);

-- 5) Create COMMENTS
CREATE TABLE COMMENTS (
    comment_id   INT AUTO_INCREMENT PRIMARY KEY,
    post_id      INT NOT NULL,
    user_id      INT NOT NULL,
    content      VARCHAR(400) NOT NULL,
    comment_date DATETIME DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_comments_posts FOREIGN KEY (post_id) REFERENCES POSTS(post_id),
    CONSTRAINT fk_comments_users FOREIGN KEY (user_id) REFERENCES USERS(user_id)
);
